# Задание ESB

## Требования
Реализовать методы API для работы с кошельком пользователя. Ограничения:
* У пользователя может быть только один кошелек.
* Поддерживаемые валюты: USD и RUB.
* При вызове метода для изменения кошелька на сумму с отличной валютой от
валюты кошелька, сумма должна конвертироваться по курсу.
* Курсы обновляются периодически.
* Все изменения кошелька должны фиксироваться в БД.

### Метод для изменения баланса
Обязательные параметры метода:
* ID кошелька (например: 241, 242)
* Тип транзакции (debit или credit)
* Сумма, на которую нужно изменить баланс
* Валюта суммы (допустимы значения: USD, RUB)
* Причина изменения счета (например: stock, refund). Список причин фиксирован.
### Метод для получения текущего баланса
Обязательные параметры метода:
* ID кошелька (например: 241, 242)

SQL запрос
Написать SQL запрос, который вернет сумму, полученную по причине refund за
последние 7 дней.

## Технические требования
* Серверная логика должна быть написана на PHP версии >=7.0
* Для хранения данных должна использоваться реляционная СУБД
* Должны быть инструкции для развертывания проекта

## Допущения
* Выбор дополнительных технологий не ограничен;
* Все спорные вопросы в задаче может и должен решать Исполнитель;

# Правила развертки
* Создать базу данных money_demo на сервере localhost
* Пользователя MySql с логином и паролем money_demo и правами на изменение БД money_demo 
  * изменить данные подключения к БД можно в файле models/settings/connectionInfo.json
* сделать клон ветки, запустить из командной 
  * git clone https://github.com/aatk/ESB.git && cd ESB && git checkout money_demo
* Веб сервер настроить на папку ESB, куда склонировалась ветка 
* Запустить на веб сервере (localhost или по настройке apache) http://localhost/System/updatesystem (Обновление системы, первоначальная настройка)
# Проверка работоспособности сервисов
* Баланс пользователя "1" кошелек в рублях - http://localhost/Money/get_balance/1
* Баланс пользователя "2" кошелек в долларах - http://localhost/Money/get_balance/2
* Пополнить баланс пользователя "1" на 100 Рублей - http://localhost/Money/change_balance/1/debit/100/RUB/refund
* Снять с баланса пользователя "1" 50 Рублей - http://localhost/Money/change_balance/1/credit/50/RUB/stock
* Пополнить баланс пользователя "1" на 100 Долларов - http://localhost/Money/change_balance/1/debit/100/USD/refund
* Снять с баланса пользователя "1" 10 Долларов - http://localhost/Money/change_balance/1/credit/10/USD/stock
* Пополнить баланс пользователя "2" на 1000 Рублей - http://localhost/Money/change_balance/2/debit/1000/RUB/refund
* Снять с баланса пользователя "2" 500 Рублей - http://localhost/Money/change_balance/2/credit/500/RUB/stock
* Пополнить баланс пользователя "2" на 1000 Долларов - http://localhost/Money/change_balance/2/debit/1000/USD/refund
* Снять с баланса пользователя "2" 100 Долларов - http://localhost/Money/change_balance/2/credit/100/USD/stock
* Просмотреть сумму всех операций refund за 7 дней - http://localhost/Money/get_last_refunds/
# Расположение данных по папкам
1. Контроллер Money - controllers/Money.controller.php (Принимающий файл для сервисов)
2. Модель контроллера - models/MoneyM.model.php (Подключения к БД)
3. View контроллера - views/MoneyV.view.php
4. Настройки подключения к БД - models/settings/connectionInfo.json